{% load static %}
<html>
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Asha Software | Search</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="author" content="colorlib.com">
    <link href="https://fonts.googleapis.com/css?family=Lato:100,300,400,700,900" rel="stylesheet" />
    <link rel="stylesheet" href="{% static 'css/main.css' %}">
    <link rel="stylesheet" href="{% static 'css/api-integration.css' %}">
    <link rel="stylesheet" href="{% static 'css/hamburger-menu.css' %}">
  </head>
  <body>
    <div class="s006">
      <div class="website-logo">
        <a href="{% url 'home' %}">
          <div class="logo">
            <img class="logo-size" src="{% static 'images/logo-light.svg' %}" alt="">
          </div>
        </a>
      </div>
      <!-- Hamburger Menu -->
      <div class="hamburger-menu">
        <div class="hamburger-icon">
          <span></span>
          <span></span>
          <span></span>
        </div>
      </div>
      <div class="menu-items">
        <a href="{% url 'tool_list' %}">Tools</a>
        <a href="{% url 'apikey_list' %}">API Keys</a>
        <a href="{% url 'logout' %}">Logout</a>
        <button class="menu-close-btn">Close</button>
      </div>
      <div class="menu-overlay"></div>
      <div class="search-container">
        <form action="{% url 'search' %}" method="POST">
          {% csrf_token %}
          <fieldset>
            <div class="inner-form">
              <div class="input-field">
                <button class="btn-search" type="submit">
                  <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24">
                    <path d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"></path>
                  </svg>
                </button>
                <input id="search" name="search" type="text" placeholder="" value="" />
              </div>
            </div>
            <div class="suggestion-wrap">
              <label class="suggestion-item">
                <input type="checkbox" name="source" value="calculator">
                <span>AP News</span>
              </label>
              <label class="suggestion-item">
                <input type="checkbox" name="source" value="wikipedia">
                <span>CNN</span>
              </label>
              {% if user_tools %}
                {% for tool in user_tools %}
                <label class="suggestion-item">
                  <input type="checkbox" name="source" value="{{ tool.name }}" {% if tool.is_preferred %}checked{% endif %}>
                  <span>{{ tool.name }}</span>
                </label>
                {% endfor %}
              {% else %}
                <label class="suggestion-item">
                  <input type="checkbox" name="source" value="custom">
                  <span>Custom</span>
                </label>
              {% endif %}
            </div>
          </fieldset>
        </form>
        
        <div class="search-results">
          <div id="loading" class="loading" style="display: none;">
            <p style="color: white;">Analyzing your query...</p>
            <div class="spinner"></div>
          </div>
          <div id="results-container" style="display: none;">
          </div>
        </div>
      </div>
    </div>
  <script src="{% static 'js/hamburger-menu.js' %}"></script>
<script>
  document.getElementById('search').addEventListener('focus', function() {
    this.value = '';
  });

  // When the form is submitted
  document.querySelector('form').addEventListener('submit', function(e) {
    e.preventDefault();
    
    const searchQuery = document.getElementById('search').value.trim();
    if (!searchQuery) return;
    
    const loadingElement = document.getElementById('loading');
    const resultsContainer = document.getElementById('results-container');
    const searchContainer = document.querySelector('.search-container');
    
    // Add a class to the search container to add padding when results are shown
    searchContainer.classList.add('with-results');
    
    if (loadingElement) {
      loadingElement.style.display = 'block';
    }
    
    if (resultsContainer) {
      resultsContainer.style.display = 'none';
    }

    const selectedSources = Array.from(document.querySelectorAll('input[name="source"]:checked'))
      .map(checkbox => checkbox.value);

    // Fix API URL for browser access
    let apiUrl = '{{ API_URL }}';
    if (apiUrl.includes('api:8000')) {
      apiUrl = apiUrl.replace('api:8000', 'localhost:8001');
    }
    
    // Get the API key
    fetch('/api/api-keys/', {
      method: 'GET',
      headers: {
        'X-Requested-With': 'XMLHttpRequest'
      },
      credentials: 'include'
    })
    .then(response => response.json())
    .then(data => {
      const apiKey = data.api_key;
      
      // Use the API key to make the query
      return fetch(apiUrl + '/query', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
          'X-Requested-With': 'XMLHttpRequest',
          'X-API-Key': apiKey
        },
        body: JSON.stringify({
          body: searchQuery,
          sources: selectedSources
        })
      });
    })
    .then(response => {
      if (!response.ok) {
        return response.text().then(text => {
          throw new Error(`Network response was not ok: ${response.status} ${response.statusText}`);
        });
      }
      return response.json();
    })
    .then(data => {
      const loadingElement = document.getElementById('loading');
      const resultsContainer = document.getElementById('results-container');
      
      if (loadingElement) {
        loadingElement.style.display = 'none';
      }
      
      if (resultsContainer) {
        resultsContainer.style.display = 'block';
        resultsContainer.innerHTML = '';

        // Check if data is an object with analyses array (new format)
        if (data.analyses && Array.isArray(data.analyses)) {
          // Create a container for the entire response
          const responseContainer = document.createElement('div');
          responseContainer.className = 'response-container';
          
          // Add a title for the response
          const responseTitle = document.createElement('h2');
          responseTitle.textContent = 'Analysis Results';
          responseTitle.className = 'response-title';
          responseContainer.appendChild(responseTitle);
          
          // Add final verdict if available
          if (data.final_label && data.final_justification) {
            const finalVerdictTable = document.createElement('table');
            finalVerdictTable.className = 'claims-table final-verdict-table';
            
            // Create table header with color based on final label
            const finalHeader = document.createElement('thead');
            const finalHeaderRow = document.createElement('tr');
            
            const finalTitleHeader = document.createElement('th');
            finalTitleHeader.textContent = 'Final Verdict';
            finalTitleHeader.colSpan = 2;
            
            // Set header color based on final label
            if (data.final_label === 'true') {
              finalTitleHeader.className = 'final-verdict-true';
            } else {
              finalTitleHeader.className = 'final-verdict-false';
            }
            
            finalHeaderRow.appendChild(finalTitleHeader);
            
            finalHeader.appendChild(finalHeaderRow);
            finalVerdictTable.appendChild(finalHeader);
            
            // Create table body
            const finalTableBody = document.createElement('tbody');
            
            // Add row for final label
            const finalLabelRow = document.createElement('tr');
            
            const finalLabelTitle = document.createElement('td');
            finalLabelTitle.textContent = 'Final Label';
            finalLabelTitle.className = 'label-title';
            finalLabelRow.appendChild(finalLabelTitle);
            
            const finalLabelValue = document.createElement('td');
            const finalVerdictIcon = document.createElement('img');
            finalVerdictIcon.src = data.final_label === 'true' ? 
              "{% static 'images/yes.png' %}" : 
              "{% static 'images/no.png' %}";
            finalVerdictIcon.alt = data.final_label === 'true' ? 'True' : 'False';
            finalVerdictIcon.className = 'verdict-icon';
            finalLabelValue.appendChild(finalVerdictIcon);
            finalLabelValue.appendChild(document.createTextNode(data.final_label));
            finalLabelRow.appendChild(finalLabelValue);
            
            finalTableBody.appendChild(finalLabelRow);
            
            // Add row for final justification
            const finalJustificationRow = document.createElement('tr');
            
            const finalJustificationTitle = document.createElement('td');
            finalJustificationTitle.textContent = 'Final Justification';
            finalJustificationTitle.className = 'label-title';
            finalJustificationRow.appendChild(finalJustificationTitle);
            
            const finalJustificationValue = document.createElement('td');
            finalJustificationValue.textContent = data.final_justification || 'No final justification provided';
            finalJustificationRow.appendChild(finalJustificationValue);
            
            finalTableBody.appendChild(finalJustificationRow);
            
            finalVerdictTable.appendChild(finalTableBody);
            responseContainer.appendChild(finalVerdictTable);
          }
          
          // Create a container for analyses with expandable sections
          const analysesContainer = document.createElement('div');
          analysesContainer.className = 'analyses-container';
          
          // Add a title for the analyses
          const analysesTitle = document.createElement('h3');
          analysesTitle.textContent = 'Analysis Results';
          analysesTitle.className = 'analyses-title';
          analysesContainer.appendChild(analysesTitle);
          
          // Create cards for each analysis
          for (let i = 0; i < data.analyses.length; i++) {
            const analysis = data.analyses[i];
            
            // Create a card for this analysis
            const analysisCard = document.createElement('div');
            analysisCard.className = 'analysis-card';
            
            // Create the top section with claim and verdict (non-collapsible)
            const topSection = document.createElement('div');
            topSection.className = 'top-section';
            
            // Add claim
            const claimContainer = document.createElement('div');
            claimContainer.className = 'claim-container';
            
            const claimLabel = document.createElement('span');
            claimLabel.className = 'field-label';
            claimLabel.textContent = 'Claim: ';
            claimContainer.appendChild(claimLabel);
            
            const claimText = document.createElement('span');
            claimText.className = 'claim-text';
            claimText.textContent = analysis.claim;
            claimContainer.appendChild(claimText);
            
            topSection.appendChild(claimContainer);
            
            // Add verdict with icon
            const verdictContainer = document.createElement('div');
            verdictContainer.className = 'verdict-container';
            
            const verdictLabel = document.createElement('span');
            verdictLabel.className = 'field-label';
            verdictLabel.textContent = 'Verdict: ';
            verdictContainer.appendChild(verdictLabel);
            
            const verdictIcon = document.createElement('img');
            verdictIcon.src = analysis.label === 'true' ? 
              "{% static 'images/yes.png' %}" : 
              "{% static 'images/no.png' %}";
            verdictIcon.alt = analysis.label === 'true' ? 'True' : 'False';
            verdictIcon.className = 'verdict-icon';
            verdictContainer.appendChild(verdictIcon);
            
            const verdictText = document.createElement('span');
            verdictText.className = 'verdict-text';
            verdictText.textContent = analysis.label === 'true' ? 'True' : 'False';
            verdictContainer.appendChild(verdictText);
            
            topSection.appendChild(verdictContainer);
            analysisCard.appendChild(topSection);
            
            // Create collapsible section
            const collapsibleSection = document.createElement('div');
            collapsibleSection.className = 'collapsible-section';
            
            // Create collapsible header
            const collapsibleHeader = document.createElement('div');
            collapsibleHeader.className = 'collapsible-header';
            
            const expandIcon = document.createElement('span');
            expandIcon.className = 'expand-icon';
            expandIcon.innerHTML = '&#9654;'; // Right-pointing triangle
            collapsibleHeader.appendChild(expandIcon);
            
            const detailsText = document.createElement('span');
            detailsText.textContent = 'Show Details';
            detailsText.className = 'details-text';
            collapsibleHeader.appendChild(detailsText);
            
            collapsibleSection.appendChild(collapsibleHeader);
            
            // Create expandable content
            const expandableContent = document.createElement('div');
            expandableContent.className = 'expandable-content';
            expandableContent.style.display = 'none'; // Initially hidden
            
            // Add justification section
            const justificationSection = document.createElement('div');
            justificationSection.className = 'content-section justification-section';
            
            const justificationTitle = document.createElement('h4');
            justificationTitle.textContent = 'Justification';
            justificationSection.appendChild(justificationTitle);
            
            const justificationContent = document.createElement('div');
            justificationContent.className = 'section-content';
            justificationContent.textContent = analysis.justification || 'No justification provided';
            justificationSection.appendChild(justificationContent);
            
            expandableContent.appendChild(justificationSection);
            
            // Add evidence section
            const evidenceSection = document.createElement('div');
            evidenceSection.className = 'content-section evidence-section';
            
            const evidenceTitle = document.createElement('h4');
            evidenceTitle.textContent = 'Evidence';
            evidenceSection.appendChild(evidenceTitle);
            
            const evidenceContent = document.createElement('div');
            evidenceContent.className = 'section-content';
            
            if (analysis.evidence && analysis.evidence.length > 0) {
              const evidenceList = document.createElement('ul');
              evidenceList.className = 'evidence-list';
              
              analysis.evidence.forEach(evidence => {
                const evidenceItem = document.createElement('li');
                evidenceItem.className = 'evidence-item';
                
                const evidenceName = document.createElement('div');
                evidenceName.className = 'evidence-name';
                evidenceName.textContent = `Source: ${evidence.name || 'Unknown'}`;
                evidenceItem.appendChild(evidenceName);
                
                const evidenceResult = document.createElement('div');
                evidenceResult.className = 'evidence-result';
                
                // Handle different types of evidence results
                if (typeof evidence.result === 'string') {
                  evidenceResult.textContent = evidence.result;
                } else {
                  evidenceResult.textContent = JSON.stringify(evidence.result);
                }
                
                evidenceItem.appendChild(evidenceResult);
                evidenceList.appendChild(evidenceItem);
              });
              
              evidenceContent.appendChild(evidenceList);
            } else {
              evidenceContent.textContent = 'No evidence provided';
            }
            
            evidenceSection.appendChild(evidenceContent);
            expandableContent.appendChild(evidenceSection);
            
            // Add expandable content to the card
            analysisCard.appendChild(expandableContent);
            
            // Add expandable content to the collapsible section
            collapsibleSection.appendChild(expandableContent);
            
            // Add collapsible section to the card
            analysisCard.appendChild(collapsibleSection);
            
            // Add click handler to toggle expansion
            collapsibleHeader.addEventListener('click', function() {
              // Toggle the display of expandable content
              if (expandableContent.style.display === 'none') {
                expandableContent.style.display = 'block';
                expandIcon.innerHTML = '&#9660;'; // Down-pointing triangle
                detailsText.textContent = 'Hide Details';
                collapsibleSection.classList.add('expanded');
              } else {
                expandableContent.style.display = 'none';
                expandIcon.innerHTML = '&#9654;'; // Right-pointing triangle
                detailsText.textContent = 'Show Details';
                collapsibleSection.classList.remove('expanded');
              }
            });
            
            // Add the card to the container
            analysesContainer.appendChild(analysisCard);
          }
          
          responseContainer.appendChild(analysesContainer);
          
          // Add the raw JSON data in a collapsible section
          const rawDataContainer = document.createElement('div');
          rawDataContainer.className = 'raw-data-container';
          
          const rawDataToggle = document.createElement('button');
          rawDataToggle.className = 'raw-data-toggle';
          rawDataToggle.textContent = 'Show Raw JSON Data';
          rawDataToggle.onclick = function() {
            const rawDataContent = document.getElementById('raw-data-content');
            if (rawDataContent.style.display === 'none') {
              rawDataContent.style.display = 'block';
              this.textContent = 'Hide Raw JSON Data';
            } else {
              rawDataContent.style.display = 'none';
              this.textContent = 'Show Raw JSON Data';
            }
          };
          rawDataContainer.appendChild(rawDataToggle);
          
          const rawDataContent = document.createElement('pre');
          rawDataContent.id = 'raw-data-content';
          rawDataContent.className = 'raw-data-content';
          rawDataContent.style.display = 'none';
          rawDataContent.textContent = JSON.stringify(data, null, 2);
          rawDataContainer.appendChild(rawDataContent);
          
          responseContainer.appendChild(rawDataContainer);
          
          resultsContainer.appendChild(responseContainer);
          
          // Add some CSS styles for the table and other elements
          const style = document.createElement('style');
          style.textContent = `
            .response-container {
              background-color: #fff;
              border-radius: 8px;
              padding: 20px;
              margin-top: 20px;
              box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            }
            
            .response-title {
              color: #333;
              margin-bottom: 20px;
              text-align: center;
            }
            
            /* Styles for the analyses container */
            .analyses-container {
              margin-top: 20px;
            }
            
            .analyses-title {
              color: #333;
              margin-bottom: 15px;
              font-size: 1.3em;
            }
            
            /* Styles for analysis cards */
            .analysis-card {
              background-color: #f9f9f9;
              border-radius: 6px;
              margin-bottom: 15px;
              box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
              transition: all 0.3s ease;
              overflow: hidden;
              border-left: 4px solid #ddd;
            }
            
            .analysis-card.expanded {
              box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
              border-left-color: #4a90e2;
            }
            
            /* Top section styles (non-collapsible) */
            .top-section {
              display: flex;
              justify-content: space-between;
              align-items: center;
              padding: 15px;
              background-color: #f2f2f2;
              border-bottom: 1px solid #e0e0e0;
            }
            
            .field-label {
              font-weight: 600;
              color: #555;
              margin-right: 5px;
            }
            
            .claim-container {
              flex: 1;
              padding-right: 15px;
            }
            
            .claim-text {
              color: #333;
            }
            
            .verdict-container {
              display: flex;
              align-items: center;
              padding: 4px 10px;
              border-radius: 4px;
            }
            
            /* Collapsible section styles */
            .collapsible-section {
              border-top: 1px solid #eee;
            }
            
            .collapsible-header {
              display: flex;
              align-items: center;
              padding: 10px 15px;
              background-color: #f9f9f9;
              cursor: pointer;
              transition: background-color 0.2s ease;
            }
            
            .collapsible-header:hover {
              background-color: #f0f0f0;
            }
            
            .collapsible-section.expanded .collapsible-header {
              background-color: #e8e8e8;
            }
            
            .expand-icon {
              margin-right: 10px;
              font-size: 12px;
              color: #555;
              transition: transform 0.2s ease;
            }
            
            .details-text {
              font-size: 0.9em;
              color: #666;
            }
            
            .verdict-icon {
              width: 20px;
              height: 20px;
              margin-right: 8px;
              vertical-align: middle;
            }
            
            .verdict-text {
              font-weight: 500;
            }
            
            /* Expandable content styles */
            .expandable-content {
              padding: 0 15px 15px;
              border-top: 1px solid #eee;
              background-color: white;
            }
            
            .content-section {
              margin-top: 15px;
            }
            
            .content-section h4 {
              color: #555;
              margin-bottom: 8px;
              font-size: 1.1em;
              font-weight: bold;
              border-bottom: 1px solid #eee;
              padding-bottom: 5px;
            }
            
            .section-content {
              padding: 10px;
              background-color: #f9f9f9;
              border-radius: 4px;
              line-height: 1.5;
            }
            
            /* Evidence list styles */
            .evidence-list {
              list-style-type: none;
              padding: 0;
              margin: 0;
              max-height: 300px;
              overflow-y: auto;
            }
            
            .evidence-item {
              margin-bottom: 15px;
              padding-bottom: 15px;
              border-bottom: 1px dashed #eee;
            }
            
            .evidence-item:last-child {
              margin-bottom: 0;
              padding-bottom: 0;
              border-bottom: none;
            }
            
            .evidence-name {
              font-weight: bold;
              margin-bottom: 5px;
              color: #4a90e2;
            }
            
            .evidence-result {
              font-size: 0.9em;
              white-space: pre-wrap;
              background-color: #f2f2f2;
              padding: 8px;
              border-radius: 3px;
              margin-top: 5px;
              border-left: 3px solid #ddd;
            }
            
            /* Final verdict table styles */
            .final-verdict-table {
              margin-bottom: 30px;
              border: 1px solid #ddd;
              border-radius: 6px;
              overflow: hidden;
            }
            
            .final-verdict-table th.final-verdict-true {
              background-color: #4CAF50;
              color: white;
            }
            
            .final-verdict-table th.final-verdict-false {
              background-color: #F44336;
              color: white;
            }
            
            .label-title {
              font-weight: bold;
              width: 200px;
              background-color: #f8f8f8;
            }
            
            .raw-data-container {
              margin-top: 30px;
            }
            
            .raw-data-toggle {
              background-color: #f2f2f2;
              border: none;
              padding: 10px 15px;
              border-radius: 4px;
              cursor: pointer;
              font-size: 14px;
            }
            
            .raw-data-toggle:hover {
              background-color: #e0e0e0;
            }
            
            .raw-data-content {
              background-color: #f8f8f8;
              padding: 15px;
              border-radius: 4px;
              overflow-x: auto;
              margin-top: 10px;
              border: 1px solid #ddd;
              white-space: pre-wrap;
            }
            
            /* Add padding to search container when results are shown */
            .search-container.with-results {
              padding-top: 100px;
            }
          `;
          document.head.appendChild(style);
          
          if (data.analyses.length === 0) {
            const noResults = document.createElement('div');
            noResults.className = 'no-results';
            noResults.textContent = 'No results found for your query.';
            resultsContainer.appendChild(noResults);
          }
        } else if (data.claims && Array.isArray(data.claims) && 
            data.labels && Array.isArray(data.labels) && 
            data.justifications && Array.isArray(data.justifications)) {
          // Original format handling (keeping this for backward compatibility)
          
          // Create a container for the entire response
          const responseContainer = document.createElement('div');
          responseContainer.className = 'response-container';
          
          // Add a title for the response
          const responseTitle = document.createElement('h2');
          responseTitle.textContent = 'Analysis Results';
          responseTitle.className = 'response-title';
          responseContainer.appendChild(responseTitle);
          
          // Create a container for analyses with expandable sections
          const claimsContainer = document.createElement('div');
          claimsContainer.className = 'analyses-container';
          
          // Add a title for the analyses
          const claimsTitle = document.createElement('h3');
          claimsTitle.textContent = 'Claims Analysis';
          claimsTitle.className = 'analyses-title';
          claimsContainer.appendChild(claimsTitle);
          
          // Create cards for each claim
          for (let i = 0; i < data.claims.length; i++) {
            // Create a card for this claim
            const claimCard = document.createElement('div');
            claimCard.className = 'analysis-card';
            
            // Create the top section with claim and verdict (non-collapsible)
            const topSection = document.createElement('div');
            topSection.className = 'top-section';
            
            // Add claim
            const claimContainer = document.createElement('div');
            claimContainer.className = 'claim-container';
            
            const claimLabel = document.createElement('span');
            claimLabel.className = 'field-label';
            claimLabel.textContent = 'Claim: ';
            claimContainer.appendChild(claimLabel);
            
            const claimText = document.createElement('span');
            claimText.className = 'claim-text';
            claimText.textContent = data.claims[i];
            claimContainer.appendChild(claimText);
            
            topSection.appendChild(claimContainer);
            
            // Add verdict with icon
            const verdictContainer = document.createElement('div');
            verdictContainer.className = 'verdict-container';
            
            const verdictLabel = document.createElement('span');
            verdictLabel.className = 'field-label';
            verdictLabel.textContent = 'Verdict: ';
            verdictContainer.appendChild(verdictLabel);
            
            const verdictIcon = document.createElement('img');
            verdictIcon.src = data.labels[i] === 'true' ? 
              "{% static 'images/yes.png' %}" : 
              "{% static 'images/no.png' %}";
            verdictIcon.alt = data.labels[i] === 'true' ? 'True' : 'False';
            verdictIcon.className = 'verdict-icon';
            verdictContainer.appendChild(verdictIcon);
            
            const verdictText = document.createElement('span');
            verdictText.className = 'verdict-text';
            verdictText.textContent = data.labels[i] === 'true' ? 'True' : 'False';
            verdictContainer.appendChild(verdictText);
            
            topSection.appendChild(verdictContainer);
            claimCard.appendChild(topSection);
            
            // Create collapsible section
            const collapsibleSection = document.createElement('div');
            collapsibleSection.className = 'collapsible-section';
            
            // Create collapsible header
            const collapsibleHeader = document.createElement('div');
            collapsibleHeader.className = 'collapsible-header';
            
            const expandIcon = document.createElement('span');
            expandIcon.className = 'expand-icon';
            expandIcon.innerHTML = '&#9654;'; // Right-pointing triangle
            collapsibleHeader.appendChild(expandIcon);
            
            const detailsText = document.createElement('span');
            detailsText.textContent = 'Show Justification';
            detailsText.className = 'details-text';
            collapsibleHeader.appendChild(detailsText);
            
            collapsibleSection.appendChild(collapsibleHeader);
            
            // Create expandable content
            const expandableContent = document.createElement('div');
            expandableContent.className = 'expandable-content';
            expandableContent.style.display = 'none'; // Initially hidden
            
            // Add justification section
            const justificationSection = document.createElement('div');
            justificationSection.className = 'content-section justification-section';
            
            const justificationTitle = document.createElement('h4');
            justificationTitle.textContent = 'Justification';
            justificationSection.appendChild(justificationTitle);
            
            const justificationContent = document.createElement('div');
            justificationContent.className = 'section-content';
            justificationContent.textContent = data.justifications[i] || 'No justification provided';
            justificationSection.appendChild(justificationContent);
            
            expandableContent.appendChild(justificationSection);
            
            // Add expandable content to the card
            claimCard.appendChild(expandableContent);
            
            // Add expandable content to the collapsible section
            collapsibleSection.appendChild(expandableContent);
            
            // Add collapsible section to the card
            claimCard.appendChild(collapsibleSection);
            
            // Add click handler to toggle expansion
            collapsibleHeader.addEventListener('click', function() {
              // Toggle the display of expandable content
              if (expandableContent.style.display === 'none') {
                expandableContent.style.display = 'block';
                expandIcon.innerHTML = '&#9660;'; // Down-pointing triangle
                detailsText.textContent = 'Hide Justification';
                collapsibleSection.classList.add('expanded');
              } else {
                expandableContent.style.display = 'none';
                expandIcon.innerHTML = '&#9654;'; // Right-pointing triangle
                detailsText.textContent = 'Show Justification';
                collapsibleSection.classList.remove('expanded');
              }
            });
            
            // Add the card to the container
            claimsContainer.appendChild(claimCard);
          }
          
          responseContainer.appendChild(claimsContainer);
          
          // Add final verdict if available
          if (data.final_label && data.final_justification) {
            const finalVerdictContainer = document.createElement('div');
            finalVerdictContainer.className = 'final-verdict-container';
            
            const finalVerdictTitle = document.createElement('h3');
            finalVerdictTitle.textContent = 'Final Verdict';
            finalVerdictContainer.appendChild(finalVerdictTitle);
            
            const finalVerdictContent = document.createElement('div');
            finalVerdictContent.className = 'final-verdict-content';
            
            const finalVerdictLabel = document.createElement('div');
            finalVerdictLabel.className = 'final-verdict-label';
            
            const finalVerdictIcon = document.createElement('img');
            finalVerdictIcon.src = data.final_label === 'true' ? 
              "{% static 'images/yes.png' %}" : 
              "{% static 'images/no.png' %}";
            finalVerdictIcon.alt = data.final_label === 'true' ? 'True' : 'False';
            finalVerdictIcon.className = 'verdict-icon';
            
            finalVerdictLabel.appendChild(finalVerdictIcon);
            finalVerdictLabel.appendChild(document.createTextNode(data.final_label));
            finalVerdictContent.appendChild(finalVerdictLabel);
            
            const finalVerdictJustification = document.createElement('p');
            finalVerdictJustification.className = 'final-verdict-justification';
            finalVerdictJustification.textContent = data.final_justification || 'No final justification provided';
            finalVerdictContent.appendChild(finalVerdictJustification);
            
            finalVerdictContainer.appendChild(finalVerdictContent);
            responseContainer.appendChild(finalVerdictContainer);
          }
          
          // Add the raw JSON data in a collapsible section
          const rawDataContainer = document.createElement('div');
          rawDataContainer.className = 'raw-data-container';
          
          const rawDataToggle = document.createElement('button');
          rawDataToggle.className = 'raw-data-toggle';
          rawDataToggle.textContent = 'Show Raw JSON Data';
          rawDataToggle.onclick = function() {
            const rawDataContent = document.getElementById('raw-data-content');
            if (rawDataContent.style.display === 'none') {
              rawDataContent.style.display = 'block';
              this.textContent = 'Hide Raw JSON Data';
            } else {
              rawDataContent.style.display = 'none';
              this.textContent = 'Show Raw JSON Data';
            }
          };
          rawDataContainer.appendChild(rawDataToggle);
          
          const rawDataContent = document.createElement('pre');
          rawDataContent.id = 'raw-data-content';
          rawDataContent.className = 'raw-data-content';
          rawDataContent.style.display = 'none';
          rawDataContent.textContent = JSON.stringify(data, null, 2);
          rawDataContainer.appendChild(rawDataContent);
          
          responseContainer.appendChild(rawDataContainer);
          
          resultsContainer.appendChild(responseContainer);
          
          // Add some CSS styles for the table and other elements
          const style = document.createElement('style');
          style.textContent = `
            .response-container {
              background-color: #fff;
              border-radius: 8px;
              padding: 20px;
              margin-top: 20px;
              box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            }
            
            .response-title {
              color: #333;
              margin-bottom: 20px;
              text-align: center;
            }
            
            .claims-table {
              width: 100%;
              border-collapse: collapse;
              margin-bottom: 20px;
            }
            
            .claims-table th, .claims-table td {
              padding: 12px;
              text-align: left;
              border-bottom: 1px solid #ddd;
            }
            
            .claims-table th {
              background-color: #f2f2f2;
              font-weight: bold;
            }
            
            .claims-table tr:hover {
              background-color: #f5f5f5;
            }
            
            .verdict-icon {
              width: 20px;
              height: 20px;
              margin-right: 8px;
              vertical-align: middle;
            }
            
            .final-verdict-container {
              margin-top: 30px;
              padding: 15px;
              background-color: #f9f9f9;
              border-radius: 8px;
              border-left: 4px solid #4CAF50;
            }
            
            .final-verdict-container h3 {
              color: #333;
              margin-top: 0;
            }
            
            .final-verdict-content {
              display: flex;
              flex-direction: column;
            }
            
            .final-verdict-label {
              font-weight: bold;
              margin-bottom: 10px;
            }
            
            .final-verdict-justification {
              margin-top: 0;
              line-height: 1.5;
            }
            
            .raw-data-container {
              margin-top: 30px;
            }
            
            .raw-data-toggle {
              background-color: #f2f2f2;
              border: none;
              padding: 10px 15px;
              border-radius: 4px;
              cursor: pointer;
              font-size: 14px;
            }
            
            .raw-data-toggle:hover {
              background-color: #e0e0e0;
            }
            
            .raw-data-content {
              background-color: #f8f8f8;
              padding: 15px;
              border-radius: 4px;
              overflow-x: auto;
              margin-top: 10px;
              border: 1px solid #ddd;
              white-space: pre-wrap;
            }
          `;
          document.head.appendChild(style);
          
          if (data.claims.length === 0) {
            const noResults = document.createElement('div');
            noResults.className = 'no-results';
            noResults.textContent = 'No results found for your query.';
            resultsContainer.appendChild(noResults);
          }
        } else if (Array.isArray(data)) {
          // Handle the case where data is already an array (for backward compatibility)
          data.forEach(result => {
            const resultCard = document.createElement('div');
            resultCard.className = 'result-card';
            
            const header = document.createElement('div');
            header.className = 'result-header';
            
            const title = document.createElement('h2');
            title.textContent = result.claim || 'Claim Analysis';
            
            const icon = document.createElement('img');
            // Use label instead of verdict
            icon.src = result.label === 'true' ? 
              "{% static 'images/yes.png' %}" : 
              "{% static 'images/no.png' %}";
            icon.alt = result.label === 'true' ? 'True' : 'False';
            icon.className = 'result-icon';
            
            header.appendChild(title);
            header.appendChild(icon);
            
            const content = document.createElement('div');
            content.className = 'result-content';
            
            const reasoning = document.createElement('p');
            // Use justification instead of reasoning
            reasoning.textContent = result.justification || 'No reasoning provided';
            content.appendChild(reasoning);
            
            // Display evidence instead of sources
            if (result.evidence && result.evidence.length > 0) {
              const sourceDiv = document.createElement('div');
              sourceDiv.className = 'result-source';
              sourceDiv.textContent = 'Evidence: ';
              
              result.evidence.forEach((evidence, index) => {
                const sourceText = document.createElement('span');
                sourceText.textContent = evidence.name || `Evidence ${index + 1}`;
                
                sourceDiv.appendChild(sourceText);
                
                if (index < result.evidence.length - 1) {
                  sourceDiv.appendChild(document.createTextNode(', '));
                }
              });
              
              content.appendChild(sourceDiv);
            }
            
            resultCard.appendChild(header);
            resultCard.appendChild(content);
            
            resultsContainer.appendChild(resultCard);
          });
          
          if (data.length === 0) {
            const noResults = document.createElement('div');
            noResults.className = 'no-results';
            noResults.textContent = 'No results found for your query.';
            resultsContainer.appendChild(noResults);
          }
        } else {
          // If data is neither an object with arrays nor an array itself
          const errorDiv = document.createElement('div');
          errorDiv.className = 'error';
          errorDiv.textContent = 'Unexpected response format from the server.';
          resultsContainer.appendChild(errorDiv);
        }
      }
    })
    .catch(error => {
      const loadingElement = document.getElementById('loading');
      const resultsContainer = document.getElementById('results-container');
      
      if (loadingElement) {
        loadingElement.style.display = 'none';
      }
      
      if (resultsContainer) {
        resultsContainer.style.display = 'block';
        resultsContainer.innerHTML = `<div class="error">Error processing your request: ${error.message}</div>`;
      }
    });
  });
</script>
</body>

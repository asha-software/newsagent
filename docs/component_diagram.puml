@startuml NewsAgent Component Diagram

' Positioning: top-to-bottom flow
top to bottom direction

' 1. Define the Client actor at the top-left
actor Client

' 2. API Layer
package "API Layer" {
  [FastAPI App] as app
  [Middleware] as middleware
  note right of app: Handles HTTP requests & routes them to the processing pipeline
}

' 3. Storage (immediately after the API Layer, so it appears below)
package "Storage" {
  [MySQL Database] as database
  note bottom of database: Stores user data, API keys, and logs
}

middleware -[hidden]- database


' 4. Processing Pipeline
package "Processing Pipeline" {
  [Processing] as processing
  note right of processing: Orchestrates the workflow between agents
}

' 5. Agents
package "Agents" {
  [Claim Decomposer] as decomposer
  [Research Agent] as research
  [Reasoning Agent] as reasoning
  [Verdict Agent] as verdict
  note right of decomposer: Breaks down complex claims
  note right of research: Gathers evidence using tools
  note right of reasoning: Evaluates claims based on evidence
  note right of verdict: Produces a final verdict
}

' 6. Tools System
package "Tools System" {
  [Tool Registry] as registry
  [Built-in Tools] as builtins
  [Custom Tools] as customTools
  note bottom of registry: For user-defined tools
  note bottom of builtins: Predefined tools like Wikipedia & Web Search
  note bottom of customTools: Tools for specific external APIs
}

' 7. Utilities
package "Utilities" {
  [LLM Factory] as llmFactory
  [Common Types] as commonTypes
  note bottom of llmFactory: Creates instances of ChatOllama, ChatOpenAI, etc.
  note bottom of commonTypes: Shared data structures (e.g., Evidence, Analysis)
}

' Data flow arrows
' Client to API
Client -right-> app : Submits claim
app -left-> Client : Returns verdict

' API to storage
app -down-> database : Reads/writes data

' Relationships
app -down-> middleware : Uses
middleware -up-> app : Adds auth & rate limiting
app -down-> processing : Forwards requests
processing -down-> decomposer : Sends claims
decomposer -down-> research : Sends atomic claims
research -down-> registry : Loads tools
research -down-> builtins : Uses tools
research -down-> reasoning : Provides evidence
reasoning -down-> verdict : Sends evaluations
processing -down-> verdict : Collects final verdict
processing -down-> llmFactory : Uses LLMs
processing -down-> commonTypes : Uses shared types

@enduml